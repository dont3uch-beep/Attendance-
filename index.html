<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2k25 Pharm-D Attendance</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; border-top: 5px solid #2c3e50; }
        h2 { color: #2c3e50; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .cr-tag { background: #34495e; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; display: inline-block; margin-bottom: 20px; }
        input { width: 90%; padding: 12px; margin-bottom: 10px; border: 2px solid #dfe6e9; border-radius: 8px; font-size: 16px; }
        button { width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .download-btn { background: #2980b9; }
        .search-box { width: 100%; max-width: 500px; margin: 20px 0; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        table { width: 100%; max-width: 600px; margin-top: 10px; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #34495e; color: white; }
        .edit-btn { background: #f39c12; padding: 5px 10px; font-size: 11px; width: auto; margin: 0; }
        .delete-btn { background: #e74c3c; padding: 5px 10px; font-size: 11px; width: auto; margin: 0; }
    </style>
</head>
<body>

    <div class="card">
        <h2>2k25 Pharm-D</h2>
        <div class="cr-tag">CR: Zuhaib Ali</div>
        <input type="text" id="rollNumber" placeholder="Enter Roll Number">
        <button onclick="markAttendance()">Mark Today's Attendance</button>
        <button class="download-btn" onclick="downloadCSV()">Export Excel (CSV)</button>
    </div>

    <input type="text" id="searchBar" class="search-box" placeholder="ðŸ” Search Roll Number..." onkeyup="updateTable()">

    <table>
        <thead>
            <tr>
                <th>Roll No</th>
                <th>Total Days</th>
                <th>Last Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="attendanceBody"></tbody>
    </table>

    <script>
        let registry = JSON.parse(localStorage.getItem('pharm2k25Data')) || {};

        function updateTable() {
            const tableBody = document.getElementById('attendanceBody');
            const filter = document.getElementById('searchBar').value.toLowerCase();
            tableBody.innerHTML = '';
            
            for (let roll in registry) {
                if (roll.toLowerCase().includes(filter)) {
                    const row = `<tr>
                        <td><b>${roll}</b></td>
                        <td>${registry[roll].count}</td>
                        <td>${registry[roll].lastDate}</td>
                        <td>
                            <button class="edit-btn" onclick="editEntry('${roll}')">Edit</button>
                            <button class="delete-btn" onclick="deleteEntry('${roll}')">Del</button>
                        </td>
                    </tr>`;
                    tableBody.innerHTML += row;
                }
            }
        }

        function markAttendance() {
            const roll = document.getElementById('rollNumber').value.trim();
            const today = new Date().toLocaleDateString('en-GB'); 

            if (!roll) return alert("Enter Roll Number");

            if (!registry[roll]) {
                registry[roll] = { count: 1, lastDate: today };
            } else {
                if (registry[roll].lastDate === today) {
                    alert("Already marked for today!");
                } else {
                    registry[roll].count++;
                    registry[roll].lastDate = today;
                }
            }
            saveAndRefresh();
            document.getElementById('rollNumber').value = '';
        }

        function editEntry(roll) {
            const newCount = prompt(`Update Total Attendance for ${roll}:`, registry[roll].count);
            const newDate = prompt(`Update Last Date (DD/MM/YYYY) for ${roll}:`, registry[roll].lastDate);
            
            if (newCount !== null && newDate !== null) {
                registry[roll].count = parseInt(newCount);
                registry[roll].lastDate = newDate;
                saveAndRefresh();
            }
        }

        function deleteEntry(roll) {
            if(confirm(`Delete all records for ${roll}?`)) {
                delete registry[roll];
                saveAndRefresh();
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('pharm2k25Data', JSON.stringify(registry));
            updateTable();
        }

        function downloadCSV() {
            let csv = 'Roll Number,Total Attendance,Last Date\n';
            for (let roll in registry) {
                csv += `${roll},${registry[roll].count},${registry[roll].lastDate}\n`;
            }
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '2k25_PharmD_Attendance.csv';
            a.click();
        }

        updateTable();
    </script>
</body>
</html>
